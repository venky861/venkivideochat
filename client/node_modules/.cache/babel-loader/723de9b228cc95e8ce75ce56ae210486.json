{"ast":null,"code":"import _slicedToArray from\"/home/venkatesh/Desktop/javascript coding/react-video-chat/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/slicedToArray\";import React,{useEffect,useRef,useState}from\"react\";import Peer from\"simple-peer\";import io from\"socket.io-client\";import queryString from\"query-string\";var hostname=\"localhost:4000\";var socket=io(hostname);var Homepage=function Homepage(_ref){var location=_ref.location;var videoRef=useRef(null);var peerVideoRef=useRef(null);var _useState=useState(\"\"),_useState2=_slicedToArray(_useState,2),sessionActive=_useState2[0],setSessionActive=_useState2[1];//  const [adminStream, adminSetStream] = useState(\"\")\nvar _useState3=useState(\"\"),_useState4=_slicedToArray(_useState3,2),name=_useState4[0],setName=_useState4[1];var _useState5=useState([]),_useState6=_slicedToArray(_useState5,2),totalNames=_useState6[0],setTotalNames=_useState6[1];var _useState7=useState(\"\"),_useState8=_slicedToArray(_useState7,2),adminName=_useState8[0],setAdminName=_useState8[1];var _useState9=useState(\"\"),_useState10=_slicedToArray(_useState9,2),peerName=_useState10[0],setPeerName=_useState10[1];useEffect(function(){var _queryString$parse=queryString.parse(location.search),name=_queryString$parse.name;setName(name);console.log(name);navigator.mediaDevices.getUserMedia({video:true,audio:true}).then(function(stream){console.log(name);socket.emit(\"NewClient\",name);//  adminSetStream(stream)\nvideoRef.current.srcObject=stream;videoRef.current.play();console.log(videoRef.current);var client={};function InitPeer(type){console.log(\"peer received\");var peer=new Peer({initiator:type===\"init\"?true:false,stream:stream,trickle:false});console.log(\"peer\",peer);peer.on(\"stream\",function(stream){console.log(\"stream\",stream);if(peerVideoRef.current){peerVideoRef.current.srcObject=stream;peerVideoRef.current.play();}});peer.on(\"close\",function(){peerVideoRef.current.remove();peer.destroy();console.log(\"peer destroyed\");});return peer;}socket.on(\"CreatePeer\",function(){client.gotAnswer=false;var peer=InitPeer(\"init\");peer.on(\"signal\",function(data){if(!client.gotAnswer){socket.emit(\"offer\",data);}});client.peer=peer;});socket.on(\"backOffer\",function(offer){var peer=InitPeer(\"notInit\");peer.on(\"signal\",function(data){socket.emit(\"Answer\",data);});peer.signal(offer);client.peer=peer;});socket.on(\"backAnswer\",function(answer){client.gotAnswer=true;var peer=client.peer;peer.signal(answer);});socket.on(\"SessionActive\",function(){setSessionActive(\"Session is active , Please comeback later\");videoRef.current.remove();});}).catch(function(err){return console.log(err);});},[location.search]);// console.log(adminStream)\nsocket.on(\"sending names peer\",function(data){setTotalNames(data);});useEffect(function(){totalNames&&totalNames.map(function(data,index){if(data===name){setAdminName(data);}else{setPeerName(data);}});},[totalNames]);return/*#__PURE__*/React.createElement(\"div\",null,/*#__PURE__*/React.createElement(\"h4\",{className:\"heading\"},\" Welcome to video chat\"),/*#__PURE__*/React.createElement(\"p\",{className:\"heading\"},sessionActive),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 col-sm-6 d-flex justify-content-center \"},/*#__PURE__*/React.createElement(\"h5\",{className:\"adminName\"},adminName),/*#__PURE__*/React.createElement(\"div\",{className:\"embed-responsive embed-responsive-16by9 videoAdmin\"},/*#__PURE__*/React.createElement(\"video\",{ref:videoRef,className:\"embed-responsive-item\",muted:true}))),/*#__PURE__*/React.createElement(\"div\",{className:\"col-12 col-sm-6 d-flex justify-content-center \"},/*#__PURE__*/React.createElement(\"h5\",{className:\"peerName\"},peerName),/*#__PURE__*/React.createElement(\"div\",{className:\"embed-responsive embed-responsive-16by9 videoPeer\"},/*#__PURE__*/React.createElement(\"video\",{ref:peerVideoRef,className:\"\\\"embed-responsive-item\\\"\"}))));};export default Homepage;","map":{"version":3,"sources":["/home/venkatesh/Desktop/javascript coding/react-video-chat/client/src/Homepage.js"],"names":["React","useEffect","useRef","useState","Peer","io","queryString","hostname","socket","Homepage","location","videoRef","peerVideoRef","sessionActive","setSessionActive","name","setName","totalNames","setTotalNames","adminName","setAdminName","peerName","setPeerName","parse","search","console","log","navigator","mediaDevices","getUserMedia","video","audio","then","stream","emit","current","srcObject","play","client","InitPeer","type","peer","initiator","trickle","on","remove","destroy","gotAnswer","data","offer","signal","answer","catch","err","map","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\"\nimport Peer from \"simple-peer\"\nimport io from \"socket.io-client\"\nimport queryString from \"query-string\"\n\nconst hostname = \"localhost:4000\"\nconst socket = io(hostname)\n\nconst Homepage = ({ location }) => {\n  const videoRef = useRef(null)\n  const peerVideoRef = useRef(null)\n  const [sessionActive, setSessionActive] = useState(\"\")\n  //  const [adminStream, adminSetStream] = useState(\"\")\n  const [name, setName] = useState(\"\")\n  const [totalNames, setTotalNames] = useState([])\n  const [adminName, setAdminName] = useState(\"\")\n  const [peerName, setPeerName] = useState(\"\")\n\n  useEffect(() => {\n    const { name } = queryString.parse(location.search)\n    setName(name)\n    console.log(name)\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        console.log(name)\n        socket.emit(\"NewClient\", name)\n        //  adminSetStream(stream)\n        videoRef.current.srcObject = stream\n        videoRef.current.play()\n        console.log(videoRef.current)\n\n        let client = {}\n\n        function InitPeer(type) {\n          console.log(\"peer received\")\n          let peer = new Peer({\n            initiator: type === \"init\" ? true : false,\n            stream: stream,\n            trickle: false,\n          })\n\n          console.log(\"peer\", peer)\n\n          peer.on(\"stream\", (stream) => {\n            console.log(\"stream\", stream)\n            if (peerVideoRef.current) {\n              peerVideoRef.current.srcObject = stream\n              peerVideoRef.current.play()\n            }\n          })\n\n          peer.on(\"close\", () => {\n            peerVideoRef.current.remove()\n            peer.destroy()\n            console.log(\"peer destroyed\")\n          })\n\n          return peer\n        }\n\n        socket.on(\"CreatePeer\", () => {\n          client.gotAnswer = false\n\n          let peer = InitPeer(\"init\")\n          peer.on(\"signal\", (data) => {\n            if (!client.gotAnswer) {\n              socket.emit(\"offer\", data)\n            }\n          })\n          client.peer = peer\n        })\n\n        socket.on(\"backOffer\", (offer) => {\n          let peer = InitPeer(\"notInit\")\n\n          peer.on(\"signal\", (data) => {\n            socket.emit(\"Answer\", data)\n          })\n          peer.signal(offer)\n          client.peer = peer\n        })\n\n        socket.on(\"backAnswer\", (answer) => {\n          client.gotAnswer = true\n          let peer = client.peer\n          peer.signal(answer)\n        })\n\n        socket.on(\"SessionActive\", () => {\n          setSessionActive(\"Session is active , Please comeback later\")\n          videoRef.current.remove()\n        })\n      })\n      .catch((err) => console.log(err))\n  }, [location.search])\n\n  // console.log(adminStream)\n  socket.on(\"sending names peer\", (data) => {\n    setTotalNames(data)\n  })\n\n  useEffect(() => {\n    totalNames &&\n      totalNames.map((data, index) => {\n        if (data === name) {\n          setAdminName(data)\n        } else {\n          setPeerName(data)\n        }\n      })\n  }, [totalNames])\n\n  return (\n    <div>\n      <h4 className='heading'> Welcome to video chat</h4>\n      <p className='heading'>{sessionActive}</p>\n\n      <div className='col-12 col-sm-6 d-flex justify-content-center '>\n        <h5 className='adminName'>{adminName}</h5>\n        <div className='embed-responsive embed-responsive-16by9 videoAdmin'>\n          <video ref={videoRef} className='embed-responsive-item' muted></video>\n        </div>\n      </div>\n\n      <div className='col-12 col-sm-6 d-flex justify-content-center '>\n        <h5 className='peerName'>{peerName}</h5>\n        <div className='embed-responsive embed-responsive-16by9 videoPeer'>\n          <video ref={peerVideoRef} className='\"embed-responsive-item\"'></video>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Homepage\n"]},"metadata":{},"sourceType":"module"}