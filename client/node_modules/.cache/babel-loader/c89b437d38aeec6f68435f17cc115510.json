{"ast":null,"code":"var _jsxFileName = \"/home/venkatesh/Desktop/javascript coding/react-video-chat/client/src/Homepage.js\";\nimport React, { useEffect, useRef, useState } from \"react\";\nimport Peer from \"simple-peer\";\nimport io from \"socket.io-client\";\nimport queryString from \"query-string\";\nconst hostname = \"localhost:4000\";\nconst socket = io(hostname);\n\nconst Homepage = ({\n  location\n}) => {\n  const videoRef = useRef(null);\n  const peerVideoRef = useRef(null);\n  const [sessionActive, setSessionActive] = useState(\"\"); //  const [adminStream, adminSetStream] = useState(\"\")\n\n  const [name, setName] = useState(\"\");\n  const [totalNames, setTotalNames] = useState([]);\n  const [adminName, setAdminName] = useState(\"\");\n  const [peerName, setPeerName] = useState(\"\");\n  useEffect(() => {\n    const {\n      name\n    } = queryString.parse(location.search);\n    setName(name);\n    console.log(name);\n    navigator.mediaDevices.getUserMedia({\n      video: true,\n      audio: true\n    }).then(stream => {\n      console.log(name);\n      socket.emit(\"NewClient\", name); //  adminSetStream(stream)\n\n      videoRef.current.srcObject = stream;\n      videoRef.current.play();\n      console.log(videoRef.current);\n      let client = {};\n\n      function InitPeer(type) {\n        console.log(\"peer received\");\n        let peer = new Peer({\n          initiator: type === \"init\" ? true : false,\n          stream: stream,\n          trickle: false\n        });\n        console.log(\"peer\", peer);\n        peer.on(\"stream\", stream => {\n          console.log(\"stream\", stream);\n\n          if (peerVideoRef.current) {\n            peerVideoRef.current.srcObject = stream;\n            peerVideoRef.current.play();\n          }\n        });\n        peer.on(\"close\", () => {\n          peerVideoRef.current.remove();\n          peer.destroy();\n          console.log(\"peer destroyed\");\n        });\n        return peer;\n      }\n\n      socket.on(\"CreatePeer\", () => {\n        client.gotAnswer = false;\n        let peer = InitPeer(\"init\");\n        peer.on(\"signal\", data => {\n          if (!client.gotAnswer) {\n            socket.emit(\"offer\", data);\n          }\n        });\n        client.peer = peer;\n      });\n      socket.on(\"backOffer\", offer => {\n        let peer = InitPeer(\"notInit\");\n        peer.on(\"signal\", data => {\n          socket.emit(\"Answer\", data);\n        });\n        peer.signal(offer);\n        client.peer = peer;\n      });\n      socket.on(\"backAnswer\", answer => {\n        client.gotAnswer = true;\n        let peer = client.peer;\n        peer.signal(answer);\n      });\n      socket.on(\"SessionActive\", () => {\n        setSessionActive(\"Session is active , Please comeback later\");\n        videoRef.current.remove();\n      });\n    }).catch(err => console.log(err));\n  }, [location.search]); // console.log(adminStream)\n\n  socket.on(\"sending names peer\", data => {\n    setTotalNames(data);\n  });\n  useEffect(() => {\n    totalNames && totalNames.map((data, index) => {\n      if (data === name) {\n        setAdminName(data);\n      } else {\n        setPeerName(data);\n      }\n    });\n  }, [totalNames]);\n  return /*#__PURE__*/React.createElement(\"div\", {\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 115,\n      columnNumber: 5\n    }\n  }, /*#__PURE__*/React.createElement(\"h4\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 116,\n      columnNumber: 7\n    }\n  }, \" Welcome to video chat\"), /*#__PURE__*/React.createElement(\"p\", {\n    className: \"heading\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 117,\n      columnNumber: 7\n    }\n  }, sessionActive), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-12 col-sm-6 d-flex justify-content-center \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 119,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    className: \"adminName\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 120,\n      columnNumber: 9\n    }\n  }, adminName), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"embed-responsive embed-responsive-16by9 videoAdmin\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 121,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: videoRef,\n    className: \"embed-responsive-item\",\n    muted: true,\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 122,\n      columnNumber: 11\n    }\n  }))), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"col-12 col-sm-6 d-flex justify-content-center \",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 126,\n      columnNumber: 7\n    }\n  }, /*#__PURE__*/React.createElement(\"h5\", {\n    className: \"peerName\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 127,\n      columnNumber: 9\n    }\n  }, peerName), /*#__PURE__*/React.createElement(\"div\", {\n    className: \"embed-responsive embed-responsive-16by9 videoPeer\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 128,\n      columnNumber: 9\n    }\n  }, /*#__PURE__*/React.createElement(\"video\", {\n    ref: peerVideoRef,\n    className: \"\\\"embed-responsive-item\\\"\",\n    __self: this,\n    __source: {\n      fileName: _jsxFileName,\n      lineNumber: 129,\n      columnNumber: 11\n    }\n  }))));\n};\n\nexport default Homepage;","map":{"version":3,"sources":["/home/venkatesh/Desktop/javascript coding/react-video-chat/client/src/Homepage.js"],"names":["React","useEffect","useRef","useState","Peer","io","queryString","hostname","socket","Homepage","location","videoRef","peerVideoRef","sessionActive","setSessionActive","name","setName","totalNames","setTotalNames","adminName","setAdminName","peerName","setPeerName","parse","search","console","log","navigator","mediaDevices","getUserMedia","video","audio","then","stream","emit","current","srcObject","play","client","InitPeer","type","peer","initiator","trickle","on","remove","destroy","gotAnswer","data","offer","signal","answer","catch","err","map","index"],"mappings":"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","sourcesContent":["import React, { useEffect, useRef, useState } from \"react\"\nimport Peer from \"simple-peer\"\nimport io from \"socket.io-client\"\nimport queryString from \"query-string\"\n\nconst hostname = \"localhost:4000\"\nconst socket = io(hostname)\n\nconst Homepage = ({ location }) => {\n  const videoRef = useRef(null)\n  const peerVideoRef = useRef(null)\n  const [sessionActive, setSessionActive] = useState(\"\")\n  //  const [adminStream, adminSetStream] = useState(\"\")\n  const [name, setName] = useState(\"\")\n  const [totalNames, setTotalNames] = useState([])\n  const [adminName, setAdminName] = useState(\"\")\n  const [peerName, setPeerName] = useState(\"\")\n\n  useEffect(() => {\n    const { name } = queryString.parse(location.search)\n    setName(name)\n    console.log(name)\n    navigator.mediaDevices\n      .getUserMedia({ video: true, audio: true })\n      .then((stream) => {\n        console.log(name)\n        socket.emit(\"NewClient\", name)\n        //  adminSetStream(stream)\n        videoRef.current.srcObject = stream\n        videoRef.current.play()\n        console.log(videoRef.current)\n\n        let client = {}\n\n        function InitPeer(type) {\n          console.log(\"peer received\")\n          let peer = new Peer({\n            initiator: type === \"init\" ? true : false,\n            stream: stream,\n            trickle: false,\n          })\n\n          console.log(\"peer\", peer)\n\n          peer.on(\"stream\", (stream) => {\n            console.log(\"stream\", stream)\n            if (peerVideoRef.current) {\n              peerVideoRef.current.srcObject = stream\n              peerVideoRef.current.play()\n            }\n          })\n\n          peer.on(\"close\", () => {\n            peerVideoRef.current.remove()\n            peer.destroy()\n            console.log(\"peer destroyed\")\n          })\n\n          return peer\n        }\n\n        socket.on(\"CreatePeer\", () => {\n          client.gotAnswer = false\n\n          let peer = InitPeer(\"init\")\n          peer.on(\"signal\", (data) => {\n            if (!client.gotAnswer) {\n              socket.emit(\"offer\", data)\n            }\n          })\n          client.peer = peer\n        })\n\n        socket.on(\"backOffer\", (offer) => {\n          let peer = InitPeer(\"notInit\")\n\n          peer.on(\"signal\", (data) => {\n            socket.emit(\"Answer\", data)\n          })\n          peer.signal(offer)\n          client.peer = peer\n        })\n\n        socket.on(\"backAnswer\", (answer) => {\n          client.gotAnswer = true\n          let peer = client.peer\n          peer.signal(answer)\n        })\n\n        socket.on(\"SessionActive\", () => {\n          setSessionActive(\"Session is active , Please comeback later\")\n          videoRef.current.remove()\n        })\n      })\n      .catch((err) => console.log(err))\n  }, [location.search])\n\n  // console.log(adminStream)\n  socket.on(\"sending names peer\", (data) => {\n    setTotalNames(data)\n  })\n\n  useEffect(() => {\n    totalNames &&\n      totalNames.map((data, index) => {\n        if (data === name) {\n          setAdminName(data)\n        } else {\n          setPeerName(data)\n        }\n      })\n  }, [totalNames])\n\n  return (\n    <div>\n      <h4 className='heading'> Welcome to video chat</h4>\n      <p className='heading'>{sessionActive}</p>\n\n      <div className='col-12 col-sm-6 d-flex justify-content-center '>\n        <h5 className='adminName'>{adminName}</h5>\n        <div className='embed-responsive embed-responsive-16by9 videoAdmin'>\n          <video ref={videoRef} className='embed-responsive-item' muted></video>\n        </div>\n      </div>\n\n      <div className='col-12 col-sm-6 d-flex justify-content-center '>\n        <h5 className='peerName'>{peerName}</h5>\n        <div className='embed-responsive embed-responsive-16by9 videoPeer'>\n          <video ref={peerVideoRef} className='\"embed-responsive-item\"'></video>\n        </div>\n      </div>\n    </div>\n  )\n}\n\nexport default Homepage\n"]},"metadata":{},"sourceType":"module"}